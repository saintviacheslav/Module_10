"use strict";(self.webpackChunksocialnetwork=self.webpackChunksocialnetwork||[]).push([[643],{7643(e,i,r){r.r(i),r.d(i,{default:()=>S});var a=r(2802),t=r(1365),n=r(5356);const s={profileInfo:"profileinfo_profileInfo__+nJOl",segmentedControl:"profileinfo_segmentedControl__JHddp",segmentedTextActive:"profileinfo_segmentedTextActive__cJZXy",segmentedText:"profileinfo_segmentedText__wk+6T",secondaryText:"profileinfo_secondaryText__N3h0Z",primaryText:"profileinfo_primaryText__IB5y0",hint:"profileinfo_hint__BkH7I",hintContent:"profileinfo_hintContent__G7r40",textarea:"profileinfo_textarea__Eak45",textareaError:"profileinfo_textareaError__QEWaH",textareaErrorText:"profileinfo_textareaErrorText__fwVXB",validateInfo:"profileinfo_validateInfo__dPsDj",title:"profileinfo_title__UVzRO",editContent:"profileinfo_editContent__lyysi",editProfileForm:"profileinfo_editProfileForm__FWT1P",profileInfoBlock:"profileinfo_profileInfoBlock__AsQqY",userMainInfo:"profileinfo_userMainInfo__Gajgw",avatarPicture:"profileinfo_avatarPicture__0R96O",inputBlock:"profileinfo_inputBlock__HAmID",editPreferencesBlock:"profileinfo_editPreferencesBlock__3fBax",editPreferencesItem:"profileinfo_editPreferencesItem__J7NuH",themeSwitcher:"profileinfo_themeSwitcher__wjhmL",languageSwitcher:"profileinfo_languageSwitcher__UhT8f"};var l=r(1134),o=r(5043),c=r(8169),m=r(5029);const d="themeswitcher_themeBlock__7ZLf1",f="themeswitcher_dark__pDvNN",u="themeswitcher_themeCircle__LgXk9",p="themeswitcher_themeCircleActive__da5g6";var h=r(579);function _(){const{theme:e,toggleTheme:i}=(0,l.DP)(),r=e===l.Sx.DARK;return(0,h.jsx)(a.A,{onClick:i,className:"".concat(d," ").concat(r?f:""),children:(0,h.jsx)("div",{className:"".concat(u," ").concat(r?p:"")})})}var g=r(6930);const x="LanguageSwitcher_wrapper__1zYzK",v="LanguageSwitcher_langButton__k26f0",j="LanguageSwitcher_active__kix2O",N=[{code:"en",label:"EN"},{code:"ru",label:"RU"}];function y(){const{i18n:e}=(0,g.Bd)();return(0,h.jsx)("div",{className:x,children:N.map(i=>{let{code:r,label:a}=i;return(0,h.jsx)("button",{type:"button",className:"".concat(v," ").concat(e.language===r?j:""),onClick:()=>e.changeLanguage(r),children:a},r)})})}var k=r(901),w=r(6573),I=r(6245),P=r(5324),T=r(3248),C=r(2532),b=r(7097),B=r(1599),L=r(8821),E=r(4336);function S(){var e,i;const{t:r}=(0,g.Bd)(),d=(0,m.Zp)(),{theme:f}=(0,l.DP)(),{user:u,logout:p,updateUser:x}=(0,c.A)(),v=(0,T.jE)(),{addToast:j}=(0,I.d)(),{values:N,errors:S,setFieldValue:A,setFieldError:F}=(0,k.m)({username:"",email:"",description:""}),[U,D]=(0,o.useState)(null),[R,O]=(0,o.useState)(null),[M,V]=(0,o.useState)(!1),H=(0,o.useRef)(null),q=50,z=N.username.length===q,J=N.email.length===q,{data:K}=(0,C.I)({queryKey:["me"],queryFn:async()=>{const{data:e}=await B.F.get("/api/me");return e},enabled:!!u});(0,o.useEffect)(()=>{if(M)return;const e=K||u;null!==e&&void 0!==e&&e.profileImage&&O((0,E.V)(e.profileImage)),V(!0)},[K,u,M]);const Q=""!==N.username.trim()||""!==N.email.trim()||""!==N.description.trim()||null!==U;const W=(0,b.n)({mutationFn:async()=>{const e={};if(N.username.trim()&&(e.username=N.username.trim()),N.email.trim()&&(e.email=N.email.trim()),N.description.trim()&&(e.description=N.description.trim()),U)try{const i=await async function(e){const i=new FormData;i.append("image",e);const{data:r}=await B.F.post("/api/upload-image",i);return r.url}(U);e.profileImage=i}catch(a){throw console.error("Image upload failed:",a),new Error(r("profile.imageUploadFailed"))}const{data:i}=await B.F.put("/api/profile",e);return i},onSuccess:e=>{j(r("profile.profileUpdated"),{type:"success"}),x(e),v.setQueryData(["me"],e),v.invalidateQueries({queryKey:["me"]}),R&&R.startsWith("blob:")&&URL.revokeObjectURL(R),D(null),e.profileImage&&O((0,E.V)(e.profileImage)),A("username",""),A("email",""),A("description","")},onError:e=>{var i,a;let t=r("profile.updateError");e instanceof L.pe&&null!==(i=e.response)&&void 0!==i&&null!==(a=i.data)&&void 0!==a&&a.message?t=e.response.data.message:e instanceof Error&&(t=e.message),console.error("Profile update error:",e),j(t,{type:"error"})}});function Z(){var e;null===(e=H.current)||void 0===e||e.click()}return(0,o.useEffect)(()=>()=>{R&&R.startsWith("blob:")&&URL.revokeObjectURL(R)},[R]),(0,h.jsxs)("div",{className:s.editContent,children:[(0,h.jsxs)("form",{className:s.editProfileForm,onSubmit:function(e){e.preventDefault(),F("email",""),F("username","");let i=!1;if(""!==N.email.trim()){const e=(0,w.DT)(N.email,r);e&&(F("email",e),i=!0)}if(""!==N.username.trim()){const e=(0,w.TU)(N.username,r);e&&(F("username",e),i=!0)}z&&(i=!0,F("username",r("errors.usernameMaxLength",{max:q}))),J&&(i=!0,F("email",r("errors.emailMaxLength",{max:q}))),200===N.description.length&&(i=!0),i||W.mutate()},children:[(0,h.jsx)("h1",{className:s.title,children:r("profile.editProfile")}),(0,h.jsxs)("div",{className:s.userMainInfo,children:[(0,h.jsx)("img",{onClick:Z,className:s.avatarPicture,src:R||(0,E.V)(null===u||void 0===u?void 0:u.profileImage)||"avatar.png",alt:"avatar"}),(0,h.jsx)("input",{type:"file",ref:H,accept:"image/jpeg,image/png,image/svg+xml",style:{display:"none"},onChange:function(e){var i;const a=null===(i=e.target.files)||void 0===i?void 0:i[0];if(!a)return;if(!["image/jpeg","image/png","image/svg+xml"].includes(a.type))return void j(r("profile.invalidAvatarType"),{type:"error"});if(a.size>10485760)return void j(r("profile.fileTooLarge"),{type:"error"});const t=URL.createObjectURL(a);O(t),D(a),e.target.value=""},disabled:W.isPending}),(0,h.jsxs)("div",{className:s.userMainText,children:[(0,h.jsxs)("p",{className:s.primaryText,children:[null===u||void 0===u?void 0:u.firstName," ",null===u||void 0===u?void 0:u.secondName]}),(0,h.jsx)("p",{style:{cursor:"pointer"},onClick:Z,className:s.secondaryText,children:r("profile.changeProfilePhoto")})]})]}),(0,h.jsxs)("div",{className:s.profileInfoBlock,children:[(0,h.jsxs)("div",{className:s.inputBlock,children:[(0,h.jsxs)("div",{className:s.hint,children:[(0,h.jsxs)("div",{className:s.hintContent,children:[(0,h.jsx)(P.I,{name:"user"}),(0,h.jsx)("p",{children:r("profile.username")})]}),S.username&&(0,h.jsx)(P.I,{name:"cross-small"})]}),(0,h.jsx)(t.A,{onChange:e=>{const i=e.target.value;i.length<=q&&A("username",i),S.username&&F("username","")},value:N.username,type:"text",placeholder:null!==(e=null===u||void 0===u?void 0:u.username)&&void 0!==e?e:"@username",status:S.username||z?"error":"default",errorText:S.username||(z?r("modalPost.characterLimit",{max:q}):""),disabled:W.isPending})]}),(0,h.jsxs)("div",{className:s.inputBlock,children:[(0,h.jsxs)("div",{className:s.hint,children:[(0,h.jsxs)("div",{className:s.hintContent,children:[(0,h.jsx)(P.I,{name:"envelope"}),(0,h.jsx)("p",{children:r("auth.email")})]}),S.email&&(0,h.jsx)(P.I,{name:"cross-small"})]}),(0,h.jsx)(t.A,{onChange:e=>{const i=e.target.value;i.length<=q&&A("email",i),S.email&&F("email","")},value:N.email,type:"text",placeholder:null!==(i=null===u||void 0===u?void 0:u.email)&&void 0!==i?i:"example@mail.com",status:S.email||J?"error":"default",errorText:S.email||(J?r("modalPost.characterLimit",{max:q}):""),disabled:W.isPending})]}),(0,h.jsxs)("div",{className:s.inputBlock,children:[(0,h.jsx)("div",{className:s.hint,children:(0,h.jsxs)("div",{className:s.hintContent,children:[(0,h.jsx)(P.I,{name:"pencil"}),(0,h.jsx)("p",{children:r("profile.description")})]})}),(0,h.jsx)(n.A,{value:N.description,onChange:e=>A("description",e),maxLength:200,placeholder:r("profile.writeDescriptionPlaceholder"),textareaClassName:200===N.description.length?s.textareaError:s.textarea})]}),(0,h.jsx)(a.A,{name:W.isPending?r("profile.saving"):r("profile.saveProfileChanges"),disabled:W.isPending||!Q})]})]}),(0,h.jsxs)("div",{className:s.editPreferencesBlock,children:[(0,h.jsxs)("div",{className:s.editPreferencesItem,children:[(0,h.jsx)("h1",{className:s.title,children:r("common.preferences")}),(0,h.jsxs)("div",{className:s.themeSwitcher,children:[(0,h.jsx)(_,{}),(0,h.jsx)("p",{className:s.primaryText,children:r("light"===f?"theme.light":"theme.dark")})]}),(0,h.jsxs)("div",{className:s.languageSwitcher,children:[(0,h.jsx)(y,{}),(0,h.jsx)("p",{className:s.primaryText,children:r("common.language")})]})]}),(0,h.jsxs)("div",{className:s.editPreferencesItem,children:[(0,h.jsx)("h1",{className:s.title,children:r("common.actions")}),(0,h.jsx)(a.A,{name:r("common.logout"),onClick:function(){p(),d("/")}})]})]})]})}}}]);
//# sourceMappingURL=643.5bcfb722.chunk.js.map